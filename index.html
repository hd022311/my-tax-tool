<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¯Œé‚¦ä¿Šå¾· | å‚³æ‰¿ä¿å…¨æ™ºæ…§è©¦ç®—</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        
        .header-box {
            background: linear-gradient(135deg, #004a99 0%, #00a950 100%);
            padding: 4rem 1.5rem 5rem 1.5rem;
            color: white;
            text-align: center;
        }

        .main-container {
            max-width: 480px;
            margin: -3rem auto 3rem auto;
            padding: 0 1rem;
        }

        .card {
            background: white;
            border-radius: 2.5rem;
            padding: 1.75rem;
            box-shadow: 0 15px 30px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* å ±å‘Šæ–‡å­—ç‰¹å¤§åŒ–è¨­å®š */
        .report-title { font-size: 1.5rem; font-weight: 900; color: #1e293b; }
        .report-main-text { font-size: 1.25rem; line-height: 1.8; color: #334155; font-weight: 600; }
        .report-highlight { font-size: 1.6rem; font-weight: 900; color: #004a99; border-bottom: 4px solid #00a950; padding: 0 2px; }
        .risk-box { background-color: #fef2f2; border-left: 8px solid #ef4444; padding: 1.5rem; border-radius: 1.5rem; }
        .risk-title { font-size: 1.3rem; font-weight: 900; color: #b91c1c; margin-bottom: 0.5rem; }
        .risk-desc { font-size: 1.15rem; font-weight: 700; color: #dc2626; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="header-box">
        <h1 class="text-3xl font-black tracking-widest mb-1">å¯Œé‚¦äººå£½ | ä¿Šå¾·</h1>
        <p class="text-sm font-bold opacity-90 tracking-tighter">è³‡ç”¢ä¿å…¨èˆ‡ç‰¹ç•™åˆ†æ™ºæ…§åˆ†æç³»çµ±</p>
    </div>

    <div class="main-container">
        <div class="card mb-6">
            <h3 class="text-lg font-black text-[#004a99] mb-5 flex items-center gap-2">
                <span class="w-2 h-6 bg-[#00a950] rounded-full"></span> ğŸ’° è³‡ç”¢ç¾æ³ (è¬å…ƒ)
            </h3>
            <div class="space-y-4">
                <div class="relative">
                    <label class="text-xs font-bold text-slate-400 absolute left-4 top-2 italic">æˆ¿ç”¢å¸‚åƒ¹</label>
                    <input type="number" id="re" placeholder="0" class="w-full pt-7 pb-3 px-4 bg-slate-50 rounded-2xl border-0 text-right font-black text-2xl focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="relative">
                        <label class="text-xs font-bold text-slate-400 absolute left-4 top-2 italic">å­˜æ¬¾ç¾é‡‘</label>
                        <input type="number" id="cash" placeholder="0" class="w-full pt-7 pb-3 px-4 bg-slate-50 rounded-2xl border-0 text-right font-black text-xl">
                    </div>
                    <div class="relative">
                        <label class="text-xs font-bold text-slate-400 absolute left-4 top-2 italic">è‚¡ç¥¨åŸºé‡‘</label>
                        <input type="number" id="stock" placeholder="0" class="w-full pt-7 pb-3 px-4 bg-slate-50 rounded-2xl border-0 text-right font-black text-xl">
                    </div>
                </div>
            </div>

            <h3 class="text-lg font-black text-[#004a99] mt-8 mb-5 flex items-center gap-2">
                <span class="w-2 h-6 bg-[#00a950] rounded-full"></span> ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ç¹¼æ‰¿æˆå“¡çµæ§‹
            </h3>
            <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-blue-50 rounded-2xl border border-blue-100">
                    <span class="font-bold text-blue-900 text-lg italic">é…å¶æ˜¯å¦åœ¨ä¸–</span>
                    <input type="checkbox" id="spouse" class="w-7 h-7 rounded-lg text-blue-600">
                </div>
                <div class="space-y-3 px-2">
                    <div class="flex items-center justify-between">
                        <span class="font-bold text-slate-600 text-lg">å­å¥³å¹¾ä½ï¼Ÿ</span>
                        <input type="number" id="child" value="0" min="0" class="w-20 bg-slate-100 p-2 text-center rounded-xl border-0 font-black text-xl">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="font-bold text-slate-400 text-lg">çˆ¶æ¯å¹¾ä½ï¼Ÿ</span>
                        <input type="number" id="parent" value="0" min="0" class="w-20 bg-slate-100 p-2 text-center rounded-xl border-0 font-black text-xl">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="font-bold text-slate-400 text-lg">å…„å¼Ÿå§Šå¦¹ï¼Ÿ</span>
                        <input type="number" id="sibling" value="0" min="0" class="w-20 bg-slate-100 p-2 text-center rounded-xl border-0 font-black text-xl">
                    </div>
                </div>
            </div>
        </div>

        <button onclick="calc()" class="w-full bg-slate-800 text-white py-5 rounded-[2rem] font-black shadow-2xl active:scale-95 transition-all text-2xl mb-12">
            ç”Ÿæˆåˆ†æå ±å‘Š
        </button>

        <div id="result" class="hidden mb-20 px-1">
            <div class="bg-white rounded-[3rem] shadow-2xl overflow-hidden border border-slate-200">
                <div class="bg-[#004a99] p-6 text-center text-white">
                    <p class="font-black text-xl tracking-widest uppercase">è³‡ç”¢ä¿å…¨å»ºè­°å ±å‘Š</p>
                </div>
                
                <div id="resultContent" class="p-8 space-y-10">
                    </div>

                <div class="p-8 pt-0 text-center">
                    <div class="h-px bg-slate-100 mb-8"></div>
                    <p class="text-slate-500 font-bold mb-4">å¯Œé‚¦ä¿Šå¾· | æ‚¨çš„å°ˆæ¥­å‚³æ‰¿é¡§å•</p>
                    <a href="https://line.me/ti/p/ä½ çš„ID" class="block w-full bg-[#00a950] text-white text-center py-5 rounded-2xl font-black shadow-lg text-xl">
                        ğŸ’¬ ç«‹å³é ç´„ 1 å° 1 è«®è©¢
                    </a>
                    <p class="text-[10px] text-slate-400 mt-6 leading-relaxed px-4">
                        âš ï¸ è¨»ï¼šæœ¬è©¦ç®—ä¾æ°‘æ³•èˆ‡113å¹´æ†²åˆ¤å­—ç¬¬3è™Ÿ(å…„å¼Ÿå§Šå¦¹ç‰¹ç•™åˆ†)ç²¾ç¥ç·¨è£½ã€‚æ•¸æ“šåŒæ­¥è‡³ä¿Šå¾·é¡§å•ç³»çµ±ï¼Œä¾›é€²éšè¦åŠƒåƒè€ƒã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userName = "å˜‰è³“";
        async function init() {
            try {
                await liff.init({ liffId: "2008902145-dYIF2R2M" });
                if (liff.isLoggedIn()) { const p = await liff.getProfile(); userName = p.displayName; }
                else { liff.login(); }
            } catch (e) { console.log(e); }
        }
        init();

        function sync(data) {
            const fid = "1lpAzMM1FJQaC8Nqfj6776KQZ-cihe0qVsXo1m4U--XU";
            const url = `https://docs.google.com/forms/d/e/${fid}/formResponse?` +
                `entry.31174987=${encodeURIComponent(userName)}&` +
                `entry.1130638521=${data.total}&` +
                `entry.2001556012=${encodeURIComponent(data.struct)}&` +
                `entry.1017830689=${encodeURIComponent(data.plan)}&` +
                `submit=Submit`;
            fetch(url, { mode: 'no-cors' });
        }

        function calc() {
            const re = parseFloat(document.getElementById('re').value) || 0;
            const cash = parseFloat(document.getElementById('cash').value) || 0;
            const stock = parseFloat(document.getElementById('stock').value) || 0;
            const totalBefore = re + cash + stock;
            if (totalBefore <= 0) return alert("è«‹è¼¸å…¥é‡‘é¡");

            const hasSpouse = document.getElementById('spouse').checked;
            const nC = parseInt(document.getElementById('child').value) || 0;
            const nP = parseInt(document.getElementById('parent').value) || 0;
            const nS = parseInt(document.getElementById('sibling').value) || 0;

            // æ³•å¾‹é †ä½é‚è¼¯
            let rank = 0; let count = 0; let rankTitle = "";
            if (nC > 0) { rank = 1; count = nC; rankTitle = "ç¬¬ä¸€é †ä½(å­å¥³)"; }
            else if (nP > 0) { rank = 2; count = nP; rankTitle = "ç¬¬äºŒé †ä½(çˆ¶æ¯)"; }
            else if (nS > 0) { rank = 3; count = nS; rankTitle = "ç¬¬ä¸‰é †ä½(å…„å¼Ÿå§Šå¦¹)"; }
            else { return alert("è«‹å¡«å¯«ç¹¼æ‰¿æˆå“¡çµæ§‹"); }

            // è¦åŠƒç­–ç•¥
            const ratio = (re / totalBefore);
            const isRE = (ratio > 0.7);
            let shift = isRE ? (re * 0.3) : (cash + stock);
            const totalAfter = totalBefore - shift;

            sync({ total: totalBefore, struct: `é…å¶:${hasSpouse?'æœ‰':'ç„¡'},å­:${nC},çˆ¶:${nP},å…„:${nS}`, plan: isRE ? 'æˆ¿ç”¢æ´»åŒ–' : 'å‚³æ‰¿å„ªåŒ–' });

            // ç‰¹ç•™åˆ†è¨ˆç®—
            let sShare = 0, hShare = 0, hRate = (rank <= 2) ? 0.5 : 0.3333;
            if (hasSpouse) {
                if (rank === 1) { sShare = 1/(count+1); hShare = 1/(count+1); }
                else if (rank === 2 || rank === 3) { sShare = 0.5; hShare = 0.5/count; }
            } else { hShare = 1/count; }

            document.getElementById('result').classList.remove('hidden');
            
            // æ†²æ³•æ³•åº­ç‰¹åˆ¥èªªæ˜
            let siblingAlert = (rank === 3) ? `
                <div class="mt-4 p-4 bg-amber-50 border-2 border-amber-200 rounded-2xl">
                    <p class="text-amber-800 font-black text-sm">ğŸ’¡ ä¿Šå¾·å°ˆæ¥­æé†’ï¼š</p>
                    <p class="text-amber-700 font-bold text-xs leading-relaxed">
                        æœ€æ–°æ†²æ³•åˆ¤æ±ºæŒ‡å‡ºå…„å¼Ÿå§Šå¦¹ç‰¹ç•™åˆ†ã€Œä¸åˆç†ã€ã€‚ä½†åœ¨æ³•å¾‹å®Œæˆä¿®æ”¹å‰ï¼Œä»éœ€é€éä¿éšªè¦åŠƒä¾†å¾¹åº•æ’é™¤ç³¾ç´›é¢¨éšªã€‚
                    </p>
                </div>
            ` : "";

            document.getElementById('resultContent').innerHTML = `
                <div class="space-y-4">
                    <div class="flex justify-between items-end border-b-2 border-slate-100 pb-4">
                        <p class="text-slate-400 font-black text-sm">åŸå§‹è³‡ç”¢ç¸½é¡</p>
                        <p class="text-3xl font-black text-slate-700">${Math.round(totalBefore).toLocaleString()} <span class="text-sm">è¬</span></p>
                    </div>
                    <div class="flex justify-between items-end">
                        <p class="text-blue-500 font-black text-sm">å„ªåŒ–å¾Œè¨ˆç®—åŸºæº–</p>
                        <p class="text-3xl font-black text-blue-600">${Math.round(totalAfter).toLocaleString()} <span class="text-sm text-blue-400">è¬</span></p>
                    </div>
                </div>

                <div class="p-6 bg-blue-50 rounded-3xl border-2 border-blue-100 shadow-inner">
                    <p class="font-black text-[#004a99] text-xl mb-3 italic">ğŸ¯ ä¿Šå¾·å°ˆæ¥­è¦åŠƒå»ºè­°</p>
                    <p class="report-main-text">
                        å»ºè­°å°‡ <span class="report-highlight">${Math.round(shift).toLocaleString()} è¬</span> ç§»è½‰è‡³ä¿éšªé ç•™é‡‘ã€‚æ­¤èˆ‰å¯æœ‰æ•ˆç¸®æ¸›éºç”¢ç¸½é¡ï¼Œé™ä½ <b>${rankTitle}</b> æœªä¾†ä¾æ³•å¯ä¸»å¼µçš„ç‰¹ç•™åˆ†é–€æª»ã€‚
                    </p>
                    ${siblingAlert}
                </div>

                <div class="risk-box shadow-sm">
                    <p class="risk-title">âš ï¸ æ ¸å¿ƒè³‡ç”¢é¢¨éšªè­¦ç¤º</p>
                    <p class="risk-desc">
                        æ‚¨çš„ä¸»è¦ç¹¼æ‰¿äººåŒ…å« <span class="underline">${rankTitle}</span>ã€‚è‹¥ç¾é‡‘å„²å‚™ä¸è¶³ä»¥æ”¯æ‡‰å…¶ç‰¹ç•™åˆ†ï¼Œæˆ¿ç”¢æè¢«è¿«è½‰ç‚ºã€Œå…¬åŒå…±æœ‰ã€ï¼Œå°è‡´ç”¢æ¬Šç³¾ç´›ï¼Œå®¶æ—ç¥–ç”¢å°‡ç„¡æ³•è²·è³£è™•åˆ†ï¼
                    </p>
                </div>

                <div class="space-y-4">
                    <h4 class="text-xs font-black text-slate-400 tracking-widest uppercase ml-1">è¦åŠƒå¾Œå–®äººç‰¹ç•™åˆ†ä¼°ç®—</h4>
                    ${renderRow("é…å¶", sShare, 0.5, totalAfter, hasSpouse)}
                    ${renderRow(rankTitle, hShare, hRate, totalAfter, true)}
                </div>
            `;
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        function renderRow(l, s, r, a, show) {
            if (!show) return '';
            const val = a * s * r;
            return `
                <div class="flex justify-between items-center bg-slate-50 p-5 rounded-2xl border border-slate-100">
                    <span class="text-lg font-bold text-slate-600">${l}</span>
                    <div class="text-right">
                        <span class="text-2xl font-black text-[#004a99]">${val.toFixed(1)}è¬</span>
                        <span class="block text-[10px] font-black text-white bg-[#00a950] px-2 rounded-full mt-1">å„ªåŒ–å¾Œé‡‘é¡</span>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
