<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¯Œé‚¦ä¿Šå¾· | å‚³æ‰¿ä¿å…¨æ™ºæ…§è©¦ç®—</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .header-box { background: linear-gradient(135deg, #004a99 0%, #00a950 100%); padding: 4rem 1.5rem 5rem; color: white; text-align: center; }
        .main-container { max-width: 480px; margin: -3rem auto 3rem; padding: 0 1rem; }
        .card { background: white; border-radius: 2.5rem; padding: 1.75rem; box-shadow: 0 15px 30px rgba(0,0,0,0.08); }
        .unit-label { position: absolute; right: 1rem; bottom: 0.75rem; font-weight: 900; color: #64748b; font-size: 1.1rem; }
        .report-highlight { font-size: 1.5rem; font-weight: 900; color: #004a99; border-bottom: 4px solid #00a950; }
        .risk-box { background-color: #fef2f2; border-left: 8px solid #ef4444; padding: 1.25rem; border-radius: 1.5rem; }
        .btn-glow { animation: shadow-pulse 2s infinite; }
        @keyframes shadow-pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 169, 80, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(0, 169, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 169, 80, 0); } }
    </style>
</head>
<body>

    <div class="header-box">
        <h1 class="text-3xl font-black tracking-widest mb-1">å¯Œé‚¦äººå£½ | ä¿Šå¾·</h1>
        <p class="text-sm font-bold opacity-90 tracking-widest">è³‡ç”¢ä¿å…¨èˆ‡ç‰¹ç•™åˆ†åˆ†æç³»çµ±</p>
    </div>

    <div class="main-container">
        <div class="card mb-6 shadow-xl border border-slate-100">
            <h3 class="text-lg font-black text-[#004a99] mb-5 border-l-4 border-[#00a950] pl-3 italic">éºç”¢è³‡ç”¢æ¦‚æ³</h3>
            <div class="space-y-4">
                <div class="relative">
                    <label class="text-xs font-bold text-slate-400 absolute left-4 top-2 italic">æˆ¿ç”¢å¸‚åƒ¹</label>
                    <input type="number" id="re" placeholder="0" class="w-full pt-7 pb-3 pl-4 pr-12 bg-slate-50 rounded-2xl border-0 text-right font-black text-2xl focus:ring-2 focus:ring-blue-500">
                    <span class="unit-label">è¬</span>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="relative">
                        <label class="text-xs font-bold text-slate-400 absolute left-4 top-2 italic">å­˜æ¬¾ç¾é‡‘</label>
                        <input type="number" id="cash" placeholder="0" class="w-full pt-7 pb-3 pl-4 pr-10 bg-slate-50 rounded-2xl border-0 text-right font-black text-xl">
                        <span class="unit-label text-sm">è¬</span>
                    </div>
                    <div class="relative">
                        <label class="text-xs font-bold text-slate-400 absolute left-4 top-2 italic">è‚¡ç¥¨åŸºé‡‘</label>
                        <input type="number" id="stock" placeholder="0" class="w-full pt-7 pb-3 pl-4 pr-10 bg-slate-50 rounded-2xl border-0 text-right font-black text-xl">
                        <span class="unit-label text-sm">è¬</span>
                    </div>
                </div>
            </div>

            <h3 class="text-lg font-black text-[#004a99] mt-8 mb-5 border-l-4 border-[#00a950] pl-3 italic">ç¹¼æ‰¿æˆå“¡çµæ§‹</h3>
            <div class="space-y-4 px-1">
                <div class="flex items-center justify-between p-4 bg-blue-50 rounded-2xl border border-blue-100 font-bold">
                    <span class="text-blue-900 text-sm">é…å¶æ˜¯å¦åœ¨ä¸–</span>
                    <input type="checkbox" id="spouse" class="w-7 h-7 rounded-lg text-blue-600">
                </div>
                <div class="flex items-center justify-between font-bold text-lg text-slate-600">
                    <span>å­å¥³äººæ•¸</span>
                    <div class="flex items-center gap-2"><input type="number" id="child" value="0" class="w-16 bg-slate-100 p-2 text-center rounded-xl border-0 font-black text-xl"> <span>äºº</span></div>
                </div>
                <div class="flex items-center justify-between font-bold text-lg text-slate-400">
                    <span>çˆ¶æ¯äººæ•¸</span>
                    <div class="flex items-center gap-2"><input type="number" id="parent" value="0" class="w-16 bg-slate-100 p-2 text-center rounded-xl border-0 font-black text-xl"> <span>äºº</span></div>
                </div>
                <div class="flex items-center justify-between font-bold text-lg text-slate-400">
                    <span>å…„å¼Ÿå§Šå¦¹</span>
                    <div class="flex items-center gap-2"><input type="number" id="sibling" value="0" class="w-16 bg-slate-100 p-2 text-center rounded-xl border-0 font-black text-xl"> <span>äºº</span></div>
                </div>
            </div>
        </div>

        <button onclick="calc()" class="w-full bg-[#1e293b] text-white py-5 rounded-[2.5rem] font-black shadow-2xl active:scale-95 transition-all text-2xl mb-12">
            é–‹å§‹æ³•å¾‹æ¬Šç›Šåˆ†æ
        </button>

        <div id="result" class="hidden mb-20">
            <div class="bg-white rounded-[3rem] shadow-2xl overflow-hidden border border-slate-200">
                <div class="bg-slate-800 p-6 text-center text-white font-black text-xl tracking-widest">æ³•å¾‹æ¬Šç›Šç¾ç‹€å ±å‘Š</div>
                
                <div class="p-8 space-y-8">
                    <div class="text-center">
                        <p class="text-slate-400 font-bold text-sm uppercase">åŸå§‹è³‡ç”¢ç¸½é¡</p>
                        <p id="totalDisplay" class="text-4xl font-black text-slate-800"></p>
                    </div>

                    <div class="space-y-4">
                        <h4 class="text-sm font-black text-slate-500 border-b pb-2 italic">âš–ï¸ ä¾æ³•æ‡‰ç¹¼åˆ†èˆ‡ç‰¹ç•™åˆ† (å–®äººä¼°è¨ˆ)</h4>
                        <div id="legalDetail" class="space-y-3"></div>
                    </div>

                    <div class="risk-box">
                        <p class="text-red-700 font-black text-lg mb-2 italic">âš ï¸ ç”¢æ¬Šé–æ­»é¢¨éšªè­¦ç¤º</p>
                        <p class="text-red-600 font-bold text-base leading-relaxed">
                            è‹¥ç¾é‡‘è³‡ç”¢ä¸è¶³ä»¥æ”¯ä»˜ä¸Šè¿°ç‰¹ç•™åˆ†ï¼Œæˆ¿ç”¢æè¢«è¿«é€²å…¥ã€Œå…¬åŒå…±æœ‰ã€é–æ­»ç‹€æ…‹ï¼Œå°è‡´å®¶æ—æˆå“¡ç„¡æ³•è‡ªç”±è²·è³£æˆ–è™•åˆ†ã€‚
                        </p>
                    </div>

                    <div id="planSection" class="pt-4">
                        <button onclick="showPlan()" class="w-full btn-glow bg-[#00a950] text-white py-6 rounded-2xl font-black text-xl shadow-xl flex items-center justify-center gap-2">
                            ğŸ’¡ ä¿Šå¾·å°ˆæ¥­å»ºè­°ï¼šå¦‚ä½•é™ä½ç‰¹ç•™åˆ†ï¼Ÿ
                        </button>
                    </div>

                    <div id="insurancePlan" class="hidden space-y-6 pt-6 border-t-2 border-dashed border-slate-200">
                        <div class="text-center">
                            <div id="discountTag" class="inline-block bg-emerald-100 text-emerald-700 px-5 py-1.5 rounded-full text-sm font-black mb-4"></div>
                        </div>
                        <div class="p-6 bg-blue-50 rounded-3xl border-2 border-blue-100">
                            <p class="font-black text-[#004a99] text-xl mb-3 italic">ğŸ¯ ä¿Šå¾·å„ªåŒ–å‚³æ‰¿è§£æ–¹</p>
                            <p id="planText" class="text-slate-700 font-bold leading-relaxed text-lg"></p>
                        </div>
                        <div class="space-y-4">
                            <h4 class="text-sm font-black text-blue-500 italic">âœ… è¦åŠƒå¾Œé è¨ˆè² æ“”å°æ¯”</h4>
                            <div id="compareDetail" class="space-y-3"></div>
                        </div>
                    </div>
                </div>

                <div class="p-8 pt-0 text-center">
                    <a href="https://line.me/R/oaMessage/@hd022311/?ä½ å¥½ä¿Šå¾·ï¼Œæˆ‘å·²å®Œæˆç‰¹ç•™åˆ†è©¦ç®—ï¼Œæƒ³é€²ä¸€æ­¥é‡å°é™ä½è² æ“”çš„è¦åŠƒé€²è¡Œè«®è©¢ã€‚" 
                       class="block w-full bg-[#004a99] text-white py-5 rounded-2xl font-black shadow-lg text-xl mb-6">ğŸ’¬ èˆ‡ä¿Šå¾·è¯ç¹«</a>
                    
                    <div class="p-4 bg-slate-50 rounded-xl text-left border border-slate-100 space-y-2">
                        <p class="text-[10px] text-slate-400 font-bold leading-relaxed">
                            ğŸ’¡ 113æ†²åˆ¤å­—ç¬¬3è™Ÿæé†’ï¼šå…„å¼Ÿå§Šå¦¹ç‰¹ç•™åˆ†è¦å®šæœ‰é•æ†²ä¹‹è™ï¼Œä¿®æ³•æœŸé–“å»ºè­°é€éä¿éšªæŒ‡å®šå—ç›Šäººç¢ºä¿å‚³æ‰¿ã€‚
                        </p>
                        <p class="text-[10px] text-slate-400 leading-relaxed italic border-t pt-2">
                            å…è²¬è²æ˜ï¼šæœ¬è©¦ç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›æ‡‰ä»¥æ³•å¾‹æ ¸å®šç‚ºæº–ã€‚æ•¸æ“šå·²åŒæ­¥è‡³ä¿Šå¾·é¡§å•ç³»çµ±ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userName = "å˜‰è³“";
        let globalData = {};

        async function init() {
            try {
                await liff.init({ liffId: "2008902145-dYIF2R2M" });
                if (liff.isLoggedIn()) { const p = await liff.getProfile(); userName = p.displayName; }
                else { liff.login(); }
            } catch (e) { console.log(e); }
        }
        init();

        function sync(data) {
            const fid = "1FAIpQLSdLrN8gX_Sfx33DkfU_kDgTTc71RKjcplz23720-ZkBcTuHTg";
            const url = `https://docs.google.com/forms/d/e/${fid}/formResponse?` +
                `entry.1835280913=${encodeURIComponent(userName)}&` +
                `entry.975087036=${data.total}&` +
                `entry.1579475738=${encodeURIComponent(data.struct)}&` +
                `entry.819629134=${encodeURIComponent(data.plan)}&` +
                `submit=Submit`;
            fetch(url, { mode: 'no-cors' });
        }

        function calc() {
            const re = parseFloat(document.getElementById('re').value) || 0;
            const cash = parseFloat(document.getElementById('cash').value) || 0;
            const stock = parseFloat(document.getElementById('stock').value) || 0;
            const total = re + cash + stock;
            if (total <= 0) return alert("è«‹è¼¸å…¥è³‡ç”¢é‡‘é¡");

            const hasSpouse = document.getElementById('spouse').checked;
            const nC = parseInt(document.getElementById('child').value) || 0;
            const nP = parseInt(document.getElementById('parent').value) || 0;
            const nS = parseInt(document.getElementById('sibling').value) || 0;

            let rank = 0, count = 0, rankTitle = "";
            if (nC > 0) { rank = 1; count = nC; rankTitle = "å­å¥³"; }
            else if (nP > 0) { rank = 2; count = nP; rankTitle = "çˆ¶æ¯"; }
            else if (nS > 0) { rank = 3; count = nS; rankTitle = "å…„å¼Ÿå§Šå¦¹"; }
            else { return alert("è«‹å¡«å¯«ç¹¼æ‰¿æˆå“¡"); }

            let sShare = 0, hShare = 0, hRate = (rank <= 2) ? 0.5 : 0.3333;
            if (hasSpouse) {
                if (rank === 1) { sShare = 1/(count+1); hShare = 1/(count+1); }
                else { sShare = 0.5; hShare = 0.5/count; }
            } else { hShare = 1/count; }

            globalData = { total, sShare, hShare, hRate, rankTitle, hasSpouse, re };

            document.getElementById('result').classList.remove('hidden');
            document.getElementById('totalDisplay').innerText = Math.round(total).toLocaleString() + " è¬";
            document.getElementById('legalDetail').innerHTML = `
                ${hasSpouse ? renderLegalRow("é…å¶", total * sShare, total * sShare * 0.5) : ''}
                ${renderLegalRow(rankTitle, total * hShare, total * hShare * hRate)}
            `;
            
            document.getElementById('insurancePlan').classList.add('hidden');
            document.getElementById('planSection').classList.remove('hidden');
            
            sync({ total: total, struct: `é…å¶:${hasSpouse?'æœ‰':'ç„¡'},å­:${nC},çˆ¶:${nP},å…„:${nS}`, plan: 'æª¢è¦–æ³•å¾‹ç¾ç‹€' });
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        function renderLegalRow(l, ej, tj) {
            return `<div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 flex justify-between items-center shadow-sm">
                <span class="font-bold text-slate-600">${l}</span>
                <div class="text-right">
                    <p class="text-[10px] text-slate-400 font-bold uppercase">æ‡‰ç¹¼åˆ†: ${Math.round(ej)}è¬</p>
                    <p class="text-xl font-black text-slate-700">ç‰¹ç•™åˆ†: ${Math.round(tj)}è¬</p>
                </div>
            </div>`;
        }

        function showPlan() {
            const { total, sShare, hShare, hRate, rankTitle, hasSpouse, re } = globalData;
            let shift = (re / total > 0.7) ? (re * 0.3) : (total * 0.25);
            const totalAfter = total - shift;
            const discountPercent = Math.round((shift / total) * 100);

            document.getElementById('insurancePlan').classList.remove('hidden');
            document.getElementById('planSection').classList.add('hidden');
            document.getElementById('discountTag').innerText = `è¦åŠƒå¾Œé è¨ˆè² æ“”é™ä½ç´„ ${discountPercent}%`;
            document.getElementById('planText').innerHTML = `
                å»ºè­°å°‡ <span class="report-highlight">${Math.round(shift).toLocaleString()} è¬</span> ç§»è½‰è‡³ä¿éšªé‡‘ã€‚è¦åŠƒå¾Œè¨ˆç®—ç‰¹ç•™åˆ†çš„éºç”¢åŸºæº–å°‡é™è‡³ ${Math.round(totalAfter).toLocaleString()} è¬ï¼Œæœ‰æ•ˆå®ˆè­·æˆ¿ç”¢ç”¢æ¬Šã€‚
            `;

            document.getElementById('compareDetail').innerHTML = `
                ${hasSpouse ? renderCompareRow("é…å¶", sShare, 0.5, total, totalAfter) : ''}
                ${renderCompareRow(rankTitle, hShare, hRate, total, totalAfter)}
            `;
            
            sync({ total: total, struct: "æª¢è¦–ä¿éšªè¦åŠƒ", plan: `é ä¼°é™ä½${discountPercent}%` });
            document.getElementById('insurancePlan').scrollIntoView({ behavior: 'smooth' });
        }

        function renderCompareRow(l, s, r, before, after) {
            const b = Math.round(before * s * r);
            const a = Math.round(after * s * r);
            return `<div class="bg-blue-50/50 p-5 rounded-2xl border border-blue-100 flex justify-between items-center shadow-inner">
                <span class="font-bold text-slate-600 text-lg">${l}</span>
                <div class="flex gap-4">
                    <div class="text-center px-3 border-r border-blue-100"><p class="text-[10px] text-slate-400 font-bold">å„ªåŒ–å‰</p><p class="text-sm line-through text-slate-400 font-bold">${b}è¬</p></div>
                    <div class="text-center"><p class="text-[10px] text-blue-500 font-bold">å„ªåŒ–å¾Œ</p><p class="text-2xl font-black text-[#004a99]">${a}è¬</p></div>
                </div>
            </div>`;
        }
    </script>
</body>
</html>
